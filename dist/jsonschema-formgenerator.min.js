!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.JsonschemaFormgenerator=t(e.jQuery)}(this,function(e){function t(t){return e.when.apply(e,t).then(function(){return e.makeArray(arguments).join("")})}function n(i,a,l){var d=i.pop(),h=d;isNaN(parseInt(d,10))||(h=i[i.length-1].slice(0,-1));var c,f,m=(i.length?i.join("-")+"-":"")+d,v=['<div class="schema-property schema-property-'+h+" schema-datatype-"+a.type+'" data-datatype="'+a.type+'">'],y=i.slice(0),g="root"+(i.length?"["+i.join("][")+"]":"")+"["+d+"]";if(y.push(d),void 0===l&&void 0!==a.default&&(l=a.default),a.options&&a.options.renderer&&(c=a.options.renderer,void 0!==p[c]))return v.push(function(){var e=[].shift.call(arguments);if(!p[e])return"";return p[e].apply(this,arguments)}(a.options.renderer,a,y,m,g,l)),v.push("</div>"),t(v);switch(a.type){case void 0:case"object":v.push(r(a,y,l));break;case"number":case"integer":a.options&&"hidden"===a.options.inputRenderer||v.push(o(m,a.title?a.title:d)),v.push(function(e,t,n,i,r){if(void 0!==e.enum)return s(e,t,n,i,r);return e.format="number",u(e,t,n,i,r)}(a,y,m,g,l));break;case"boolean":v.push(a.options&&"hidden"===a.options.inputRenderer?u(a,y,m,g,l):'<input type="checkbox" name="'+g+'" id="'+(f=m)+'" value="1"'+(l?' checked="checked"':"")+' /><label for="'+f+'">'+a.title+"</label>");break;case"array":v.push(function(i,r,s,o,u){var a=[];i.items.enum?(i.items.title=i.title,a.push(n(r,i.items,u).then(function(t){var n=e(t);return n.find("select").prop("multiple","multiple").each(function(){var t=e(this);t.attr("name",t.attr("name")+"[]").find("option").each(function(){var t=e(this);u&&-1!==u.indexOf(t.val())&&t.attr("selected","selected")})}),n.html()}))):(a.push("<fieldset>"),i.title&&a.push('<div class="legend">'+i.title+"</div>"),e.each(u||{},function(e,t){var s=r.slice(0);s.push(e),a.push(n(s,i.items,t))}),a.push("</fieldset>"));return t(a)}(a,y,0,0,l));break;case"string":if(a.isEnum=void 0!==a.enum,a.isHidden=a.options&&"hidden"===a.options.inputRenderer,a.isHidden&&(v=[]),(a.isEnum&&!a.isHidden||!a.isHidden)&&v.push(o(m,a.title?a.title:d,!a.isEnum&&a.minLength)),v.push(function(e,t,n,i,r){if(e.isEnum&&!e.isHidden)return s(e,t,n,i,r);return u(e,t,n,i,r)}(a,y,m,g,l)),a.isHidden)return t(v);break;default:throw new Error('Schema item "'+i.join(".")+'" is not valid')}return v.push("</div>"),t(v)}function i(n,i,s){var o,u=[],p=[],l=i.pop(),d=(i.length&&i.join("]["),(i.length?i.join("-")+"-":"")+l);return u.push('<label for="'+d+'">'+n.title+"</label>"),u.push('<select id="'+d+'" class="schema-property-oneOf-selector">'),i.push(l),e.each(n.oneOf,function(e,t){u.push('<option value="'+t.title+'">'+t.title+"</option>"),t.disabled=!0,p.push(r(t,i,s))}),u.push("</select>"),u.push("</div>"),u.push('<div class="schema-property schema-property-'+l+' schema-property-oneOf" style="display:none">'),u.push(t(p)),u.push("</div>"),o=function(){e(document).on("change",".schema-property-oneOf-selector",function(t){var n=e(t.target);n.closest(".schema-property").siblings(".schema-property-oneOf").show().find("> fieldset").attr("disabled","disabled").hide().each(function(t){t===n[0].selectedIndex&&e(this).removeAttr("disabled").show()})})},a.push(o),t(u)}function r(s,o,u){var a,p,l,d,h=[];return u=u||{},void 0===s.properties?s.allOf||s.extends?(h.push("<fieldset>"),h.push((a=s.allOf?s.allOf:s.extends,p=o,l=u,d=[],e.each(a,function(e,t){d.push(n(p,t,l))}),t(d))),h.push("</fieldset>"),t(h)):s.oneOf?(h.push("<fieldset>"),h.push(i(s,o,u)),h.push("</fieldset>"),t(h)):s.$ref?this.getRef(s.$ref).then(function(e){return e.properties?r(e,o,u):n(o,e,u)}):(s.type&&"array"===s.type&&s.items&&h.push(n(o,s,u)),t(h)):(h.push("<fieldset"+(s.disabled?' disabled="disabled"':"")+">"),s.title&&h.push('<div class="legend">'+s.title+"</div>"),e.each(s.properties,function(e,t){o.slice(0),o.push(e),h.push(n(o,t,u[e]))}),h.push("</fieldset>"),t(h).then(function(t){if(s.required){var n=e("<p>").html(t);return e.each(s.required,function(e,t){n.find(["input","textarea","select"].map(function(e){return".schema-property-"+t+" > "+e}).join(",")).attr("required","required")}),n.html()}return t}))}function s(t,n,i,r,s){var o=[];void 0===s&&void 0!==t.default&&(s=t.default);var u=t.options&&t.options.enum_titles?t.options.enum_titles:{},a=t.options&&t.options.inputRenderer?t.options.inputRenderer:null;if(d(a))return h(a,t,n,i,r,s);var p=t.options&&!0===t.options.multiple,l=t.options&&!0===t.options.readOnly,c=!(!t.options||!t.options.inputClasses)&&t.options.inputClasses.join(" "),f=!(!t.options||!t.options.rules)&&t.options.rules;switch(t.inputType){case"radio":o.push('<div class="radiogroup">'),e.each(t.enum,function(e,t){var n=i+"-"+t;o.push("<div>"),o.push('<input type="radio" name="'+r+'" value="'+t+'" id="'+n+'"'+(t===s?' checked="checked"':"")+'><label for="'+n+'">'+(u[e]||t)+"</label>"),o.push("</div>")}),o.push("</div>");break;default:o.push('<select name="'+r+'" id="'+i+'"'+(c?' class="'+c+'"':"")+(l?' readonly="readonly"':"")+(p?' multiple="multiple"':"")+(f?" data-rules='"+JSON.stringify(f)+"'":"")+">"),e.each(t.enum,function(e,t){o.push('<option value="'+t+'"'+(t===s?' selected="selected"':"")+">"+(u[e]||t)+"</option>")}),o.push("</select>")}return o.join("")}function o(e,t,n){return'<label for="'+e+'">'+t+(n?" *":"")+"</label>"}function u(e,t,n,i,r){var s=e.format||"text";if(e.options&&e.options.inputRenderer&&(s=e.options.inputRenderer),d(s))return h(s,e,t,n,i,r);var o=e.description,u=e.options&&1==e.options.readOnly,a=!(!e.options||!e.options.inputClasses)&&e.options.inputClasses.join(" "),p=!(!e.options||!e.options.rules)&&e.options.rules;return"textarea"===s?'<textarea type="text"'+(a?' class="'+a+'"':"")+(n?' id="'+n+'"':"")+(i?' name="'+i+'"':"")+(e.minLength?' minlength="'+e.minLength+'"':"")+(e.maxLength?' maxlength="'+e.maxLength+'"':"")+(o?' placeholder="'+o+'"':"")+(u?' readonly="true"':"")+(p?" data-rules='"+JSON.stringify(p)+"'":"")+">"+(r||"")+"</textarea>":"<input "+(s?' type="'+s+'"':"")+(a?' class="'+a+'"':"")+(n?' id="'+n+'"':"")+(i?' name="'+i+'"':"")+(e.pattern?' pattern="'+e.pattern+'"':"")+(e.minLength?' minlength="'+e.minLength+'"':"")+(e.maxLength?' maxlength="'+e.maxLength+'"':"")+(e.min?' min="'+e.min+'"':"")+(e.max?' max="'+e.max+'"':"")+(r?' value="'+r+'"':"")+(e.title?' title="'+e.title+'"':"")+(o?' placeholder="'+o+'"':"")+(u?' readonly="true"':"")+(p?" data-rules='"+JSON.stringify(p)+"'":"")+"/>"}var a=[];var p={};var l={};function d(e){return void 0!==l[e]}function h(){var e=[].shift.call(arguments);return l[e]?l[e].apply(this,arguments):""}return e.fn.appendSchema=function(t,n){var i=e(this);return r(t,[],n||{}).then(function(e){return i.append(e)})},{render:function(e,t,n){return r(e,t,n).then(function(e){return a.forEach(function(e){e()}),e})},renderChunk:n,addRenderer:function(e,t){p[e]=t},addInputRenderer:function(e,t){l[e]=t}}});